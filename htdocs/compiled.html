<html>



<head>

<title>Pre-Compiled Drivers</title>
<meta name="title" content="Precompiled CSLiS Drivers">
<meta name="keywords" content="Linux, streams, pre-compiled, drivers, CSLiS">
<meta name="description" content="About pre-compiled drivers for CSLiS">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

<style type="text/css">

<!--

h2 {  font-family: Arial, Helvetica, sans-serif}

h1 {  font-family: Arial, Helvetica, sans-serif}

h3 {  font-family: Arial, Helvetica, sans-serif}

p {  font-family: Arial, Helvetica, sans-serif; font-size: 12pt}

a {  font-family: Arial, Helvetica, sans-serif; color: #0000FF}

a:link {  font-family: Arial, Helvetica, sans-serif; color: #0000FF}

a:hover {  font-family: Arial, Helvetica, sans-serif; color: #FF3333}

li {  font-family: Arial, Helvetica, sans-serif; font-size: 10pt}

ol {  font-family: Arial, Helvetica, sans-serif; font-size: 10pt}

-->

</style>

<script language="JavaScript">

<!--

function MM_swapImgRestore() { //v3.0

  var i,x,a=document.MM_sr; for(i=0;a&&i<a.length&&(x=a[i])&&x.oSrc;i++) x.src=x.oSrc;

}



function MM_preloadImages() { //v3.0

  var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();

    var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)

    if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}

}



function MM_findObj(n, d) { //v3.0

  var p,i,x;  if(!d) d=document; if((p=n.indexOf("?"))>0&&parent.frames.length) {

    d=parent.frames[n.substring(p+1)].document; n=n.substring(0,p);}

  if(!(x=d[n])&&d.all) x=d.all[n]; for (i=0;!x&&i<d.forms.length;i++) x=d.forms[i][n];

  for(i=0;!x&&d.layers&&i<d.layers.length;i++) x=MM_findObj(n,d.layers[i].document); return x;

}



function MM_swapImage() { //v3.0

  var i,j=0,x,a=MM_swapImage.arguments; document.MM_sr=new Array; for(i=0;i<(a.length-2);i+=3)

   if ((x=MM_findObj(a[i]))!=null){document.MM_sr[j++]=x; if(!x.oSrc) x.oSrc=x.src; x.src=a[i+2];}

}

//-->

</script>

</head>







<body bgcolor="#FFFFFF" onLoad="MM_preloadImages('i/kernel_on.gif','i/download_on.gif','i/install_on.gif','i/removal_on.gif','i/loading_on.gif','i/drivers_on.gif','i/config_on.gif','i/demand_on.gif','i/compiled_on.gif','i/apps_on.gif','i/otherres_on.gif','i/command_on.gif','i/dki_on.gif','i/libs_on.gif','i/lisdrvrs_on.gif')">
<table width="700" border="0" cellspacing="0" cellpadding="0" height="120" bgcolor="#6666CC">

	 <tr> 

		  <td width="120" height="120" rowspan="3"><a href="index.html"><img src="i/penguin.gif" width="120" height="120" border="0"></a></td>

		  <td rowspan="3" width="570" height="120" align="center" valign="middle"> 

			   <h1><font color="#FFFFFF" style="font-size:30pt;">Communications Server Linux STREAMS (CSLiS)</font></h1>

			 </td>

		  <td bgcolor="#ffffff" rowspan="3" width="10" height="120"><img src="./i/sideborder.gif" width="10" height="130"></td>

	 </tr>

	 <tr> </tr>

	 <tr> </tr>

</table>

<img src="./i/bottomborder.gif" width="703" height="15"> <br>

<table width="700" border="0" cellspacing="0" cellpadding="0">

  <tr> 

    <td rowspan="2" width="100" align="left" valign="top"> 
      <table width="90" border="0" cellspacing="0" cellpadding="0">
        <tr> 
          <td><a href="kernel.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('kernel','','i/kernel_on.gif',1)"><img name="kernel" border="0" src="i/kernel_off.gif" width="81" height="35"></a></td>
        </tr>
        <tr> 
          <td><a href="download.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('download','','i/download_on.gif',1)"><img name="download" border="0" src="i/download_off.gif" width="81" height="35"></a></td>
        </tr>
        <tr> 
          <td><a href="install.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('install','','i/install_on.gif',1)"><img name="install" border="0" src="i/install_off.gif" width="81" height="35"></a></td>
        </tr>
        <tr> 
          <td><a href="removal.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('removal','','i/removal_on.gif',1)"><img name="removal" border="0" src="i/removal_off.gif" width="81" height="35"></a></td>
        </tr>
        <tr> 
          <td><a href="loading.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('loading','','i/loading_on.gif',1)"><img name="loading" border="0" src="i/loading_off.gif" width="81" height="35"></a></td>
        </tr>
        <tr> 
          <td><a href="drivers.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('drivers','','i/drivers_on.gif',1)"><img name="drivers" border="0" src="i/drivers_off.gif" width="81" height="35"></a></td>
        </tr>
        <tr> 
          <td><a href="config.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('config','','i/config_on.gif',1)"><img name="config" border="0" src="i/config_off.gif" width="81" height="35"></a></td>
        </tr>
        <tr> 
          <td><a href="demand.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('demand','','i/demand_on.gif',1)"><img name="demand" border="0" src="i/demand_off.gif" width="81" height="35"></a></td>
        </tr>
        <tr> 
          <td><a href="compiled.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('compiled','','i/compiled_on.gif',1)"><img name="compiled" border="0" src="i/compiled_off.gif" width="81" height="35"></a></td>
        </tr>
        <tr> 
          <td><a href="apps.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('apps','','i/apps_on.gif',1)"><img name="apps" border="0" src="i/apps_off.gif" width="81" height="35"></a></td>
        </tr>
        <tr> 
          <td><a href="otherres.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('otherres','','i/otherres_on.gif',1)"><img name="otherres" border="0" src="i/otherres_off.gif" width="81" height="35"></a></td>
        </tr>
        <tr> 
          <td><a href="cmds.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('cmds','','i/command_on.gif',1)"><img name="cmds" border="0" src="i/command_off.gif" width="81" height="35"></a></td>
        </tr>
        <tr> 
          <td><a href="dki.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('dki','','i/dki_on.gif',1)"><img name="dki" border="0" src="i/dki_off.gif" width="81" height="35"></a></td>
        </tr>
        <tr> 
          <td><a href="libc.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('libs','','i/libs_on.gif',1)"><img name="libs" border="0" src="i/libs_off.gif" width="81" height="35"></a></td>
        </tr>
        <tr> 
          <td><a href="drvrs.html" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('lisdrvrs','','i/lisdrvrs_on.gif',1)"><img name="lisdrvrs" border="0" src="i/lisdrvrs_off.gif" width="81" height="35"></a></td>
        </tr>
      </table>
    </td>

    <td width="600" height="75"> 

      <div align="center"> 

        <h2>Installing Pre-Compiled Drivers </h2>

      </div>

    </td>

  </tr>

  <tr> 

    <td width="600" height="100%" align="left" valign="top"> 

      <p>CSLiS makes provision for you to add your own STREAMS drivers to the build 

        of CSLiS. Drivers can be built outside the CSLiS source code tree. The object 

        code and configuration information pertaining to your driver must be copied 

        into the CSLiS source code tree in order to be incorporated into CSLiS. </p>

      <h2><font size="3">The CSLiS pkg Directory</font> </h2>

      <p>The directory <font face="Courier New, Courier, mono">/usr/src/LiS/pkg</font> 
        is the directory where pre-compiled drivers are to be copied. This directory 
        contains subdirectories, one for each driver to be linked in with CSLiS 
        when CSLiS is built. </p>

      <p>If you have a driver named <i>foo</i> then you need to do a <font face="Courier New, Courier, mono">mkdir 
        /usr/src/LiS/pkg/foo</font> to create the directory that will contain 
        the components of your driver. </p>

      <h2><font size="4"><b>Driver Components</b></font> </h2>

      <p>Copy the following files into your package directory (<font face="Courier New, Courier, mono">/usr/src/LiS/pkg/foo</font>). 
      </p>

      		   <table border="0" cellpadding="7" cellspacing="0">

					<tr> 

						 <td valign="top" width="8%" height="13">&nbsp;</td>

						 <td valign="top" width="17%" height="13"><b>Component</b></td>

						 <td valign="top" width="75%" height="13"><b>Description</b></td>

					</tr>

					<tr> 

						 <td valign="top" width="8%" height="13">&nbsp;</td>

						 <td valign="top" width="17%" height="13"> 

							  <p>Makefile</p>

						 </td>

						 <td valign="top" width="75%" height="13"> 

							  
            <p>A make file to do anything that needs to be done just prior to 
              linking your driver's object code file into LiS. If there is nothing 
              to be done then just provide a dummy default target. The Makefile 
              has to be present for the CSLiS build procedure to function properly.</p>

						 </td>

					</tr>

					<tr> 

						 <td valign="top" width="8%" height="13">&nbsp;</td>

						 <td valign="top" width="17%" height="13"> 

							  <p>Driver.o</p>

						 </td>

						 <td valign="top" width="75%" height="13"> 

							  <p>Any number of object files with suffix &quot;.o&quot; 

								   will do. These files can be copied into this 

								   directory from elsewhere, they do not have 

								   to be built by the Makefile. Alternatively, 

								   the Makefile can copy in updated driver object 

								   files as needed. Which style you use is entirely 

								   up to you.</p>

						 </td>

					</tr>

					<tr> 

						 <td valign="top" width="8%" height="13">&nbsp;</td>

						 <td valign="top" width="17%" height="13"> 

							  <p>Space.c</p>

						 </td>

						 <td valign="top" width="75%" height="13"> 

							  
            <p>This is optional. If you want to incorporate configuration information 
              from your Config file into your driver at link time, then place 
              a file by this name into your driver's package directory. Your Makefile 
              should contain an include <font face="Courier New, Courier, mono">../proto/Makefile</font> 
              to incorporate a rule to make this file into an object file. Your 
              <font face="Courier New, Courier, mono">Space.c</font> file should 
              include the file <font face="Courier New, Courier, mono">config.h</font> 
              in it. See the section on <a href="config.html">Configuration</a> 
              for more details about <font face="Courier New, Courier, mono">Space.c</font> 
              and <font face="Courier New, Courier, mono">config.h</font>.</p>

						 </td>

					</tr>

					<tr> 

						 <td valign="top" width="8%" height="13">&nbsp;</td>

						 <td valign="top" width="17%" height="13"> 

							  <p>Config</p>

						 </td>

						 <td valign="top" width="75%" height="13"> 

							  <p>This is the STREAMS configuration file for your 

								   driver. It is combined with other Config files 

								   for other drivers to produce a master Config 

								   file. This master Config file is then processed 

								   by the LiS strconf utility to produce, among 

								   other things, the file config.h. See the section 

								   on <a

                href="config.html">Configuration</a> for more information about 

								   the Config file.</p>

						 </td>

					</tr>

			   </table>

      <h2><font size="3"><a name="dynamic_loading"></a>Dynamically Loadable STREAMS 
        Drivers</font><font

        size="4"> </font></h2>

      <p>You can also compile your STREAMS driver as a loadable module and load 
        it dynamically either <a href="demand.html#demand_loading">on demand</a> 
        or using the insmod command. </p>

      <p>In order to do this you need to inform the Linux kernel that your driver 
        depends upon the CSLiS STREAMS driver. You do this by placing an entry into 
        the file <font face="Courier New, Courier, mono">/etc/conf.modules</font> 
        (on newer distributions of Linux this file has been renamed to <font face="Courier New, Courier, mono">/etc/modules.conf</font>)<font face="Courier New, Courier, mono"> 
        </font>. In order to code this entry correctly, you need to know the major 
        device number that is to be assigned to your driver. One way to find this 
        out is to make a directory for your driver in the CSLiS <font face="Courier New, Courier, mono">pkg</font> 
        directory and include a <font face="Courier New, Courier, mono"><a href="config.html#config_files">Config</a></font> 
        file but no object code. You can then use the resulting <font face="Courier New, Courier, mono">config.h</font> 
        file (located in the directory <font face="Courier New, Courier, mono">/usr/src/LiS/include/sys/LiS</font> 
        and left behind by the CSLiS build process) to determine your driver's major 
        device number. </p>

      <p>When your driver loads and you register it, you need to ask for this 

        major device number. </p>

      <p>The entry in the <font face="Courier New, Courier, mono">/etc/conf.modules</font> 
        file looks like the following: </p>

      <blockquote> 

        <p><font size="2" face="Courier New">alias char-major-<i>maj</i> streams</font> 

        </p>

      </blockquote>

      		   
      <p>This entry tells the kernel that a driver with major device number <i>maj</i> 
        is dependent upon the module named &quot;streams,&quot; the module name 
        for CSLiS. The CSLiS <font face="Courier New, Courier, mono">strconf</font> 
        utility program contains constructs which support this process. See the 
        <a

        href="config.html">Configuration</a> section for more information. </p>
      <p>Tip: Be sure not to include your driver's &quot;<font face="Courier New, Courier, mono">.o</font>&quot; 
        file in the CSLiS pkg directory. Instead you will need to copy it to the 
        appropriate subdirectory of <font face="Courier New, Courier, mono">/lib/modules</font>.</p>

      <p>&nbsp; </p>

      </td>

  </tr>

</table>

<p align="left">&nbsp;</p>



</body>



</html>



